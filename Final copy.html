<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.543">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gavin Crooks">
<meta name="dcterms.date" content="2025-04-07">

<title>Analysis and Visualization of Toronto Building Permits</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Final copy_files/libs/clipboard/clipboard.min.js"></script>
<script src="Final copy_files/libs/quarto-html/quarto.js"></script>
<script src="Final copy_files/libs/quarto-html/popper.min.js"></script>
<script src="Final copy_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Final copy_files/libs/quarto-html/anchor.min.js"></script>
<link href="Final copy_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Final copy_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Final copy_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Final copy_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Final copy_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysis and Visualization of Toronto Building Permits</h1>
<p class="subtitle lead">Exploring Building Permit Trends to Try and Source the Housing Affordability Crisis in Toronto: Insights from Open Data</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gavin Crooks </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    This paper analyzes Toronto’s building permit data to explore trends related to housing affordability in the Greater Toronto Area. Using spatial and temporal visualizations, the study examines permit issuance, construction timelines, and the creation of dwelling units. Key findings include the slow pace of new construction relative to population growth and significant variations in construction costs across postal codes. Ethical considerations around data privacy and consent are also discussed. The results highlight the challenges of addressing housing affordability in Toronto.
  </div>
</div>


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>As a young adult from the Greater Toronto Area(GTA), owning a home feels impossible. The house prices are highly unaffordable for most individuals, especially young people, as well as some of the highest rent prices in North America<span class="citation" data-cites="misc">(<a href="#ref-misc" role="doc-biblioref">Wilson 2025</a>)</span>. This motivated me to complete this analysis of building permits, specifically in Toronto. Using data from Opendatatoronto, I will create and analyze several visualizations to try and find insights into the unaffordability of housing in the GTA. This report does not try to make causal claims as a typical research paper, but rather, should describe patterns from building permit data about the city of Toronto.</p>
<p>In this paper, I aim to visualize, analyze, and describe trends in the city of Toronto’s building permit data. A number of interesting trends emerge, such as the fluctuation in the number of building permits issued over time, as well as patterns in construction costs by postal code. I explore these trends using a combination of spatial and temporal data visualizations. To complete this analysis, I use R, <span class="citation" data-cites="citeR">(<a href="#ref-citeR" role="doc-biblioref">R Core Team 2023</a>)</span>, and a variety of packages, including <span class="citation" data-cites="opendatatoronto">(<a href="#ref-opendatatoronto" role="doc-biblioref">Zhang and contributors 2021</a>)</span>, <span class="citation" data-cites="sf">(<a href="#ref-sf" role="doc-biblioref">Pebesma and contributors 2022</a>)</span>, <span class="citation" data-cites="viridis">(<a href="#ref-viridis" role="doc-biblioref">Miller and contributors 2021</a>)</span>, <span class="citation" data-cites="gifski">(<a href="#ref-gifski" role="doc-biblioref">Carvalho and contributors 2021</a>)</span>, and <span class="citation" data-cites="lubridate">(<a href="#ref-lubridate" role="doc-biblioref">Wickham and contributors 2021</a>)</span>. This approach is inspired by the methods described in Data Visualization: A Practical Introduction by Kieran Healy <span class="citation" data-cites="book">Healy (<a href="#ref-book" role="doc-biblioref">2018</a>)</span> and Telling Stories with Data by Rohan Alexander <span class="citation" data-cites="tswd">Alexander (<a href="#ref-tswd" role="doc-biblioref">2023</a>)</span></p>
<p>The remainder of this paper is structured as follows. <a href="#sec-data" class="quarto-xref">Section&nbsp;2</a> discusses the dataset used in the analysis, including its sources and key variables. <a href="#sec-ethics" class="quarto-xref">Section&nbsp;3</a> delves into the ethical considerations related to data collection and use, particularly focusing on privacy concerns and the potential impact of publicly accessible information. <a href="#sec-visualizations" class="quarto-xref">Section&nbsp;4</a> presents visualizations and discussions around the key insights from the data. Lastly, <a href="#sec-conclusion" class="quarto-xref">Section&nbsp;5</a> concludes with a reflection on the broader implications of the analysis. In <a href="#sec-appendix" class="quarto-xref">Section&nbsp;6</a>, a more broad discussion of the data is completed, specifically about this paper. The appendix also includes a brief data cleaning and data recoding explanation.</p>
</section>
<section id="sec-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data</h1>
<p>The data used in this paper comes from two sources, Opendatatoronto<span class="citation" data-cites="data">(<a href="#ref-data" role="doc-biblioref">City of Toronto 2025</a>)</span> and Statistic Canada <span class="citation" data-cites="statscan">(<a href="#ref-statscan" role="doc-biblioref">Canada 2025</a>)</span>. The primary data source is Open Data Toronto, which provides detailed records on building permits issued and completed within the City of Toronto. The data has several key variables that will be used throughout this paper including Permit Type (e.g., new construction, demolition, renovation), Application date, Issued data, Completion Dates, Project Location (postal code, street address) and Estimated Construction costs. The data is collected from permit applications and updates made by City Staff when reviewing the application and Inspecting the work on the issued permit<span class="citation" data-cites="data">(<a href="#ref-data" role="doc-biblioref">City of Toronto 2025</a>)</span>. It is important to note that two datasets are available from Opendatatoronto, one is closed or completed permits and the other is active or uncompleted permits. Both these datasets include the same variables and information. It is also important to note this data is openly available from the Opendatatoronto r package <span class="citation" data-cites="opendatatoronto">(<a href="#ref-opendatatoronto" role="doc-biblioref">Zhang and contributors 2021</a>)</span> or the Opendatatornto website<span class="citation" data-cites="data">(<a href="#ref-data" role="doc-biblioref">City of Toronto 2025</a>)</span>. For this paper, the data was obtained using the Opendatatoronto r package. The code used to obtain the data is available in the r script labelled 01_download_data. The raw data is also available in the inputs folder.</p>
<p>The second dataset is from Statistics Canada. This dataset was manually pulled from the Statistics Canada website. This dataset was used for creating the maps in this paper. Using the Forward Sortation Area (FSA), this data was merged with the building permits data set to provide the necessary shapefiles for mapping. The Forward Sortation Area Boundary File depicts the boundaries of FSAs derived from postal codes and captured from census questionnaires<span class="citation" data-cites="statscan">(<a href="#ref-statscan" role="doc-biblioref">Canada 2025</a>)</span>. It is important to note this data includes information copied with permission from Canada Post Corporation<span class="citation" data-cites="statscan">(<a href="#ref-statscan" role="doc-biblioref">Canada 2025</a>)</span>. All files manually downloaded from the Statistic Canada website are available in the folder lfsa000b21a_e.</p>
</section>
<section id="sec-ethics" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Ethics</h1>
<p>When creating or using any dataset, it is important to discuss any ethical considerations involved in the collection, use and visualization of the data. The Toronto building permit data does have some personal information, specifically, location information including street, address and postal code information. For this paper, this data was only used for the creation of maps to visualize other data. The data does not contain personal information, other than the variable BUILDER_NAME which usually consists of a company name but occasionally is an individual’s name. A large ethical concern is consent, when submitting for a permit applicants may not be fully aware that their information will be made publicly available. While the dataset is intended for transparency and urban planning purposes, individuals who submit permit applications might not have explicitly consented to the open publication of their names or detailed location data. The dataset also includes the variable DESCRIPTION which is supposed to be a description of work proposed in application. This usually consists of descriptions like “Interior alterations and build deck at rear,” however, can include more specific details like “Change existing exhaust system to Gino’s Pizza Restaurant*.” The description variable is not used in this paper its presence in the dataset raises additional ethical considerations regarding privacy and data sensitivity. While most descriptions are general, some may contain business names, tenant details, or other information that could unintentionally reveal more than intended. This could pose privacy risks, especially for small businesses or residential projects where the data might be linked to individuals.</p>
<p>There are limited ethical concerns regarding the Statistics Canada dataset in both its collection and its use in this paper. As a national statistical agency, Statistics Canada follows strict protocols for data collection, anonymization, and dissemination, ensuring that all published data comply with privacy regulations. Additionally, the dataset is used solely for mapping and visualization purposes, providing insights into broader trends rather than individual records.By ethically using this data, without misrepresenting or distorting the information, it upholds the principles of responsible data use, ensuring that any conclusions drawn accurately reflect regional patterns without compromising privacy or contributing to potential data misuse.</p>
</section>
<section id="sec-visualizations" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Visualizations</h1>
<p>In this section, several data visualizations are presented to explore key trends in the Toronto building permit data. These graphs provide insights into the spatial distribution of permits, changes in dwelling units created and lost, and construction costs across postal codes, helping to highlight important patterns and trends.</p>
<section id="data-exploration" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="data-exploration"><span class="header-section-number">4.1</span> Data Exploration</h2>
<p>To first explore the data it seemed obvious to look at the type of permits the city has issued and closed. In <a href="#fig-permit-type-1" class="quarto-xref">Figure&nbsp;1 (a)</a> and <a href="#fig-permit-type-2" class="quarto-xref">Figure&nbsp;1 (b)</a>, we can see that the majority of permits issued are small residential, plumbing, mechanical or building alterations or additions. The fifth most common permit type is new houses. This is both concerning and unsurprising at the same time. Since Toronto is already developed it is expected to not have a large number of new houses being built. Because of this using the relatively small number of new houses being built as a possible cause for the unaffordability is unreasonable.</p>
<div id="fig-permit-type" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-permit-type-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permit-type" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-permit-type-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permit-type-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permit-type-1.png" class="img-fluid figure-img" data-ref-parent="fig-permit-type" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permit-type-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) All Permit Types
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permit-type" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-permit-type-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permit-type-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permit-type-2.png" class="img-fluid figure-img" data-ref-parent="fig-permit-type" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permit-type-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Permit Types with More than 2,000 Permits
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-permit-type-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Bar plots of permit counts by type, including all permit types and focusing on those with over 2,000 permits.
</figcaption>
</figure>
</div>
<p>In any time series data, it makes a lot of sense to graph it over time. To do this I chose the variable APPLICATION_DATE believing it would show several trends. The first trend I expected was an increase in applications over time, which can be seen in <a href="#fig-permits-time-1" class="quarto-xref">Figure&nbsp;2 (a)</a>. However, I did not expect to see a large drop in applications in the past 10 years. Reviewing the dataset, I realized that this is likely a result of being the closed permit data. As a result, I obtained the open permit data and created the same graph in <a href="#fig-permits-time-2" class="quarto-xref">Figure&nbsp;2 (b)</a>. However, instead of having more permits in recent years, it had fewer, which was an unexpected result. This does not make any sense and is likely an error in the data as the permits currently open in the city should be more recent than the closed permits. As a result of this, the remainder of the paper except for <a href="#fig-permits-month-2" class="quarto-xref">Figure&nbsp;3 (b)</a> presents an interesting contrast to the closed data.</p>
<div id="fig-permits-time" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-permits-time-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permits-time" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-permits-time-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permits-time-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permits-time-1.png" class="img-fluid figure-img" data-ref-parent="fig-permits-time" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permits-time-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Closed Permits Issued per Year
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permits-time" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-permits-time-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permits-time-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permits-time-2.png" class="img-fluid figure-img" data-ref-parent="fig-permits-time" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permits-time-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Open Permits Issued per Year
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-permits-time-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Bar plots showing the number of building permits issued per year, for both closed and open permits.
</figcaption>
</figure>
</div>
<p>Another trend I expected in the data was for there to be a large variation in which months the application data for the permits was. The largest number of permits in the closed data was for small residential projects. As a result, I expected the majority of applications to occur during the spring and summer months as this is when these projects would likely be completed. In <a href="#fig-permits-month-1" class="quarto-xref">Figure&nbsp;3 (a)</a>, graphing the application date by month, we can see little variance between the months, again contradicting my expectation. This leads me to make the same graph using the open permits in <a href="#fig-permits-month-2" class="quarto-xref">Figure&nbsp;3 (b)</a>. This followed the expectation of more permit applications being completed than in other seasons as expected and shows another interesting contrast between the closed and open permit data.</p>
<div id="fig-permits-month" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-permits-month-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permits-month" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-permits-month-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permits-month-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permits-month-1.png" class="img-fluid figure-img" data-ref-parent="fig-permits-month" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permits-month-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Closed Permits Issued per Month
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permits-month" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-permits-month-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permits-month-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permits-month-2.png" class="img-fluid figure-img" data-ref-parent="fig-permits-month" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permits-month-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Open Permits Issued per Month
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-permits-month-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Bar plots showing the number of building permits issued per month, for both closed and open permits.
</figcaption>
</figure>
</div>
</section>
<section id="time-to-complete-permits" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="time-to-complete-permits"><span class="header-section-number">4.2</span> Time to Complete Permits</h2>
<p>As previously mentioned in the subsequent sections this paper will focus on the completed permits dataset. In the dataset, there are three important dates, the application date, the issued date and the completion date. A constant concern in construction whether a small residential project or large-scale condo building is time. These 3 variables all measure different aspects of construction time in Toronto. Specifically, with these variables, three new variables were calculated. The number of days to issue the permit is calculated by finding the difference between the application date and the issued date. The number of days to complete construction, the difference between the application date and completion date. Lastly, the number of days from being issued to complete. Upon creating these new variables and my initial intuition it made sense to create a histogram for each. In <a href="#fig-permit-timelines-1" class="quarto-xref">Figure&nbsp;4 (a)</a>, <a href="#fig-permit-timelines-2" class="quarto-xref">Figure&nbsp;4 (b)</a> and <a href="#fig-permit-timelines-3" class="quarto-xref">Figure&nbsp;4 (c)</a>, we can see the corresponding histograms. In <a href="#fig-permit-timelines-1" class="quarto-xref">Figure&nbsp;4 (a)</a> it is obvious that the majority of permits are approved in a very short amount of time, however, a small number of permits have taken over 6000 days to get approved. This is concerning as an increasing concern in the GTA and across Canada is the time it takes to obtain building permits. Investigating this further in the dataset several flaws appeared. For example, the permit with the longest days to approval of 6787 days, also took 6787 days to complete. Investigating further this is because both the issued date and completion date are the same. Several other permits also have the same problem, likely meaning an issue in the city’s data. However, this is not true for all permits with a long approval time. It does make sense for a larger construction project to have a longer approval time and this is the result of most of the longer approval times. For example, a permit with the description “Proposal to construct a 37-storey mixed-use building containing 377 dwelling units, commercial at grade, 3 levels of below grade parking, 1 block of townhouses and 2 semi-detached houses at the north portion of the site,” took over 5000 days to obtain approval. This makes sense as it is an extensive project but also concerning that even such a large project took so long to be approved. In <a href="#fig-permit-timelines-2" class="quarto-xref">Figure&nbsp;4 (b)</a> we see a very different distribution. The majority of projects take between 1000 and 5000 days to complete. This is also shocking as the largest portion of permits is for small residential projects, it would make sense for these projects to take a shorter amount of time to complete. Similarly, it is expected that large projects take several years to complete. However, with the variance in the type of project being undertaken, it makes sense for the distribution to be so large and have some resemblance to the normal distribution. In <a href="#fig-permit-timelines-3" class="quarto-xref">Figure&nbsp;4 (c)</a> we see a very similar distribution to <a href="#fig-permit-timelines-2" class="quarto-xref">Figure&nbsp;4 (b)</a>. This means that the total days to complete, inclusive of waiting for application approval, is extremely similar to the time from the permit being issued to completion. This indicates that the approval process is not what is causing long construction times in Toronto, but the construction itself. This is an important insight, as mentioned many believe waiting for permits is a common cause of construction times, however, contrasting these graphs shows this is not the case.</p>
<div id="fig-permit-timelines" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-permit-timelines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permit-timelines" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-permit-timelines-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permit-timelines-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permit-timelines-1.png" class="img-fluid figure-img" data-ref-parent="fig-permit-timelines" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permit-timelines-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Application to Issued
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permit-timelines" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-permit-timelines-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permit-timelines-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permit-timelines-2.png" class="img-fluid figure-img" data-ref-parent="fig-permit-timelines" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permit-timelines-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Application to Completion
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-permit-timelines" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-permit-timelines-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-permit-timelines-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-permit-timelines-3.png" class="img-fluid figure-img" data-ref-parent="fig-permit-timelines" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-permit-timelines-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Issued to Completion
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-permit-timelines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Histograms showing the distribution of time (in days) between various stages of the building permit process.
</figcaption>
</figure>
</div>
<p>After seeing the distributions for these different aspects of the permit timeline, it made sense to show them not only in a histogram but also in a boxplot(also for graphing variations). The boxplot can show the comparison between these groups in a more effective manner, allows us to see summary statistics quickly and illustrates the spreads and outliers more effectively. In <a href="#fig-boxplot" class="quarto-xref">Figure&nbsp;5</a> we can see a number of aspects of the data that were described using the histograms. Firstly, we see how similar issued to completion and application to completion are, as their interquartile ranges and overall spread are about the same. We also see that their outliers are extremely similar. We also see that the application to issued time is extremely small, just with many outliers. An important aspect of this graph is it highlights that a few permits have a negative number of days between application and being issued. This obviously does not make any sense and again shows a minor flaw in the data, however, this is only for two permits, one of which was cancelled.</p>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-boxplot" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-boxplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Boxplot showing the distribution of time (in days) between various stages of the building permit process.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>Overall, the investigation into the application date, issued date and completion date brought many insights both to the process of building in Toronto and the data. Several flaws within the data were discovered and the belief that obtaining a building permit is a lengthy process was refuted.</p>
</section>
<section id="dwelling-units" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="dwelling-units"><span class="header-section-number">4.3</span> Dwelling Units</h2>
<p>Although construction times are a useful metric to understand the high prices of shelter in the GTA, a more important factor is the number of livable units created by the construction. In the dataset, the variable DWELLING_UNITS_CREATED is the number of residential dwelling units created by the completion of permit work. DWELLING_UNITS_LOST is the number of residential dwelling units lost by completion of permit work. As the population of the GTA grows this may be a better measurement for the ability for people to live in Toronto and the GTA more broadly. So far in this report, a number of bar charts and histograms have been used. To diversify the types of visualizations used a cumulative line chart is used to show the changes in dwelling units gained, lost and a net value. In <a href="#fig-dwelling-cumulative" class="quarto-xref">Figure&nbsp;6</a> we see that the number of dwelling units lost was relatively small. The number of dwelling units added was around 24,000 units. In the green, we have the net number of units added over this time around 23,000. This sounds like a large number of units, but according to (https://www.macrotrends.net/global-metrics/cities/20402/toronto/population) the population of Toronto grew by over 1 million people in the same period(2000-2015). With only a net gain of 24,000 units and this large of a population growth, it is easy to see why housing prices in Toronto have continued to sore.</p>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-dwelling-cumulative" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dwelling-cumulative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-dwelling-cumulative-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dwelling-cumulative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Cumulative number of dwelling units created and lost in Toronto from 2000 to 2015.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="mapping" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="mapping"><span class="header-section-number">4.4</span> Mapping</h2>
<p>In this section of this report, a number of maps are created using both the closed building permit data and the shape files obtained from Statistics Canada. To do so the datasets must be merged to connect the building permit data to the shape file. This was done by joining the shape files CFSAUID variable with the building permits POSTAL variable. In <a href="#fig-cost-map" class="quarto-xref">Figure&nbsp;7</a> we can see a large variance in the amount of total estimated construction costs by postal code. Because of this large variance, a log scale was used to ensure the colour scale was able to show these differences. Two forward sortation areas had a total estimated construction cost of less than $500,000. However, other FSAs had single permits with estimated construction costs of over 100 million dollars. The permits with the largest amount of estimated construction costs had missing values for POSTAL and as a result, are not included in <a href="#fig-cost-map" class="quarto-xref">Figure&nbsp;7</a>. Overall, a large variance between FSAs can be seen, unfortunately, it is difficult if this is a result of missing estimated construction costs data, postal code data or a result of investment into large projects in certain areas.</p>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-cost-map" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cost-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-cost-map-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cost-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Map showing the total estimated construction costs by FSA in Toronto, with color scale based on the log(estimated total cost).
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>A map of the number of applications by FSA seemed like an easy to compare and contrast with <a href="#fig-cost-map" class="quarto-xref">Figure&nbsp;7</a>. <a href="#fig-app-map" class="quarto-xref">Figure&nbsp;8</a> shows some interesting insights. Firstly, the FSAs with the lowest number of permit applications do not always have the smallest amount of estimated construction cost. The obvious exception is FSA, M4A, as in both <a href="#fig-cost-map" class="quarto-xref">Figure&nbsp;7</a> and <a href="#fig-app-map" class="quarto-xref">Figure&nbsp;8</a> it is extremely dark with only an estimated construction cost of $303,000 and a total of 30 permit applications. However, in the majority of other areas, there appears to be little to no correlation between the number of applications and estimated construction costs. This further supports the idea that a number of small permits have high estimated construction costs and heavily influenced <a href="#fig-cost-map" class="quarto-xref">Figure&nbsp;7</a>. The opposite can be said for FSA, M2N, as it has the most number of applications just under 1000 but only had a total estimated construction cost of around 18 million dollars. Of course, 18 million dollars is a lot in estimated construction cost but compared to other FSAs this is relatively low.</p>
<p>It is important to note that in <a href="#fig-cost-map" class="quarto-xref">Figure&nbsp;7</a> and <a href="#fig-app-map" class="quarto-xref">Figure&nbsp;8</a>, approximately 3000 permits within the dataset were missing values for the variable POSTAL and as a result are not included in either figure. This equates to around 10% of the dataset being removed from these figures.</p>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-app-map" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-app-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-app-map-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-app-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Map showing the number of building applications by postal code in Toronto, with color scale based on the number of applications.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="gifs" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="gifs"><span class="header-section-number">4.5</span> Gifs</h2>
<p>To drive home the point made in the maps, and to diversify the figures in this report, I decided to make <a href="#fig-cost-gif" class="quarto-xref">Figure&nbsp;9</a>. This is the same map as in <a href="#fig-cost-map" class="quarto-xref">Figure&nbsp;7</a>, however is a gif, showing the estimated construction costs by FSA for each year between 2000-2015. This shows several different aspects of the data and Toronto building permits. Firstly, we can see many FSAs that have missing data, frequently changing in the first few years. As time progresses the number of FSA’s without any permits with an estimated construction cost decreases. This illustrates 2 possible trends, firstly, that more permits are created as time goes on. Or that the city’s data collection has improved over time. The difference is difficult to identify and is likely a combination of both. <a href="#fig-cost-gif" class="quarto-xref">Figure&nbsp;9</a> also allows us to see how different areas are developed over time as the FSA’s with high estimated construction costs in the first few years are and the same as the FSA’s with high estimated construction costs as years pass. Overall, <a href="#fig-cost-gif" class="quarto-xref">Figure&nbsp;9</a> is not the most useful in terms of identifying trends in the data due to all the missing results and a map’s inability to convey certain data.</p>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-cost-gif" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cost-gif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Final-copy_files/figure-html/fig-cost-gif-.gif" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cost-gif-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Animated map showing the evolution of total estimated construction costs by postal code in Toronto from 2000 to 2015. Darker colors indicate lower costs (log scale).
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-conclusion" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Conclusion</h1>
<p>This analysis of Toronto’s building permit data provides valuable insights into the trends shaping housing in the city. While the overall number of permits issued has fluctuated over time, the slow creation of new dwelling units relative to Toronto’s growing population underscores the difficulty in addressing the region’s housing affordability crisis. The investigation also reveals discrepancies in permit approval and construction timelines, with a notable variance in the time taken for small residential projects and larger developments. Furthermore, a number of geographical trends were discussed through the use of map visualizations.</p>
<p>Despite the valuable insights gained, challenges related to data quality, such as missing or inaccurate entries, must be addressed for future analyses. Ultimately, the findings suggest that while building permits are a critical part of the housing puzzle, they alone are insufficient to explain the broader housing crisis in the Greater Toronto Area.</p>
</section>
<section id="sec-appendix" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Appendix</h1>
<section id="discussion" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="discussion"><span class="header-section-number">6.1</span> Discussion</h2>
<p>Well this was an insightful and interesting analysis of the building permits in Toronto, there were a number of flaws throughout. In this section, I will briefly discuss the benefits and issues of the data used in this paper. Firstly, the data before the year 2000 is not very accurate specifically for the variable APPLICATION DATE, as a result of a number of the data being processed on numerous pre-amalgamation legacy systems with varying data collection capabilities and standards.</p>
<p>Secondly, the dataset has a large number of missing values. This impacted essentially every figure as variables such as dwellings lost, estimated construction costs or postal code were missing. Now in a practical sense dwellings were not lost or gained from every permit, so this makes sense. An estimated construction cost not being reported for small residential projects also makes sense. However, missing postal codes were more problematic, as they hindered the spatial analysis and mapping, reducing the completeness of the geographic visualizations.</p>
<p>Lastly, for reproducibility which is a major topic in <span class="citation" data-cites="tswd">Alexander (<a href="#ref-tswd" role="doc-biblioref">2023</a>)</span>, the data was obtained in <span class="citation" data-cites="citeR">R Core Team (<a href="#ref-citeR" role="doc-biblioref">2023</a>)</span> using the package <span class="citation" data-cites="opendatatoronto">Zhang and contributors (<a href="#ref-opendatatoronto" role="doc-biblioref">2021</a>)</span>. This seems like the most reliable and reproducible way to obtain the data. However, as a result of the limitations of my machine, <span class="citation" data-cites="citeR">R Core Team (<a href="#ref-citeR" role="doc-biblioref">2023</a>)</span> or <span class="citation" data-cites="opendatatoronto">Zhang and contributors (<a href="#ref-opendatatoronto" role="doc-biblioref">2021</a>)</span>, only 32,000 observations were obtained for both the closed and open permit data. This is a substantial amount but after further investigation, this is only a small subset of the data. For example, the open permit dataset as of April 4, 2025, consists of approximately 250,000 observations. This report and analysis would have been more robust had there been complete datasets. Having said that I do believe my computer would not have been able to complete a number of aspects in this report with the complete datasets as it struggled with the datasets that were used. I believe a complete analysis of the full dataset would be extremely beneficial and can be done in a reproducible manner. One benefit of not obtaining the full file manually off the website is that the data integrity was maintained which will be discussed in the data cleaning section.</p>
</section>
<section id="data-cleaning" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="data-cleaning"><span class="header-section-number">6.2</span> Data Cleaning</h2>
<p>Minimal data cleaning was needed for the dataset as every variable was coded in the correct form even including the dates, a common error. This is likely a result of obtaining the data directly from <span class="citation" data-cites="opendatatoronto">Zhang and contributors (<a href="#ref-opendatatoronto" role="doc-biblioref">2021</a>)</span>. As previously mentioned, missing values were the most consistent issue within the dataset. This is also reflected on the Opendatatoronto website as the data is rated very highly in terms of its quality, usability and metadata.</p>
<section id="recoding" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="recoding"><span class="header-section-number">6.2.1</span> Recoding</h3>
<p>Although the data was very easy to use a number of small recoding instances occurred however they were all very straightforward. Exampled include extracting the month from application date or converting to a long data format to complete certain visualizations.</p>

</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-tswd" class="csl-entry" role="listitem">
Alexander, Rohan. 2023. <span>“Telling Stories with Data.”</span> <a href="https://tellingstorieswithdata.com/" class="uri">https://tellingstorieswithdata.com/</a>.
</div>
<div id="ref-statscan" class="csl-entry" role="listitem">
Canada, Statistics. 2025. <span>“Statistics Canada Catalogue.”</span> <a href="https://www150.statcan.gc.ca/n1/en/catalogue/92-179-X">https://www150.statcan.gc.ca/n1/en/catalogue/92-179-X</a>.
</div>
<div id="ref-gifski" class="csl-entry" role="listitem">
Carvalho, Gustavo F., and the gifski contributors. 2021. <span>“Gifski: ’Gifski’ - r Interface to ’Gifski’ for Creating Animated GIFs from Image Sequences.”</span> <a href="https://cran.r-project.org/package=gifski">https://cran.r-project.org/package=gifski</a>.
</div>
<div id="ref-data" class="csl-entry" role="listitem">
City of Toronto. 2025. <span>“City of Toronto Open Data Catalogue.”</span> <a href="https://open.toronto.ca/catalogue/" class="uri">https://open.toronto.ca/catalogue/</a>.
</div>
<div id="ref-book" class="csl-entry" role="listitem">
Healy, Kieran. 2018. <em>Data Visualization: A Practical Introduction</em>. <a href="https://socviz.co/" class="uri">https://socviz.co/</a>.
</div>
<div id="ref-viridis" class="csl-entry" role="listitem">
Miller, Evan, and the viridis contributors. 2021. <span>“Viridis: Default Color Maps from ’Matplotlib’.”</span> <a href="https://cran.r-project.org/package=viridis">https://cran.r-project.org/package=viridis</a>.
</div>
<div id="ref-sf" class="csl-entry" role="listitem">
Pebesma, Edzer, and the sf contributors. 2022. <span>“Sf: Simple Features for r.”</span> <a href="https://cran.r-project.org/package=sf">https://cran.r-project.org/package=sf</a>.
</div>
<div id="ref-citeR" class="csl-entry" role="listitem">
R Core Team. 2023. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-lubridate" class="csl-entry" role="listitem">
Wickham, Hadley, and the lubridate contributors. 2021. <span>“Lubridate: Make Dealing with Dates and Times Easier.”</span> <a href="https://cran.r-project.org/package=lubridate">https://cran.r-project.org/package=lubridate</a>.
</div>
<div id="ref-misc" class="csl-entry" role="listitem">
Wilson, Jermaine. 2025. <span>“The Cost of Living Alone in Toronto: How Residents Are Coping in Light of a Proposed Rental Boom.”</span> <a href="https://www.ctvnews.ca/toronto/article/the-cost-of-living-alone-in-toronto-how-residents-are-coping-in-light-of-a-proposed-rental-boom/#:~:text=The%20average%20cost%20of%20a,behind%20Burnaby%20and%20Vancouver%2C%20B.C." class="uri">https://www.ctvnews.ca/toronto/article/the-cost-of-living-alone-in-toronto-how-residents-are-coping-in-light-of-a-proposed-rental-boom/#:~:text=The%20average%20cost%20of%20a,behind%20Burnaby%20and%20Vancouver%2C%20B.C.</a>
</div>
<div id="ref-opendatatoronto" class="csl-entry" role="listitem">
Zhang, Jianwen, and the opendatatoronto contributors. 2021. <span>“Opendatatoronto: R Client for the City of Toronto’s Open Data API.”</span> <a href="https://cran.r-project.org/package=opendatatoronto">https://cran.r-project.org/package=opendatatoronto</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>